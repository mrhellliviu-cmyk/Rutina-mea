// notifications.js
import { relaxed } from "./budget.js";

function keyToday() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}

export async function askNotificationPermission() {
  if (!("Notification" in window)) return false;
  if (Notification.permission === "granted") return true;
  const p = await Notification.requestPermission();
  return p === "granted";
}

function notify(title, body) {
  if ("Notification" in window && Notification.permission === "granted") {
    new Notification(title, { body });
  }
}

export function monthlyReminders() {
  const day = new Date().getDate();
  const t = keyToday();

  if (day === 12 && localStorage.getItem("bill12") !== t) {
    notify("PlatÄƒ: Telefon + Internet", "Azi e 12. PlÄƒteÈ™te telefon/internet.");
    localStorage.setItem("bill12", t);
  }

  if (day === 24 && localStorage.getItem("bill24") !== t) {
    notify("PlatÄƒ: Gaz + Curent", "Azi e 24. PlÄƒteÈ™te gaz/curent.");
    localStorage.setItem("bill24", t);
  }
}

export function weekendSurprise(budgetResult) {
  const dow = new Date().getDay(); // 5 vineri, 6 sÃ¢mbÄƒtÄƒ
  if (!(dow === 5 || dow === 6)) return;

  const t = keyToday();
  const last = localStorage.getItem("wk");
  if (last === t) return;

  if (relaxed(budgetResult, 20)) {
    notify("SurprizÄƒ de weekend ðŸŽ‰", "Ai buget pentru o micÄƒ ieÈ™ire bunÄƒ È™i ieftinÄƒ.");
    localStorage.setItem("wk", t);
  }
}
